Using context manager to decorate functions inside